<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"
  />
  <!-- Tell the browser to be responsive to screen width -->
  <meta
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    name="viewport"
  />
  <!-- Bootstrap 3.3.7 -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.3.1/cerulean/bootstrap.min.css"
  />
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
  />

  <!-- Theme style -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.12/js/adminlte.min.js"
  />
  <!-- AdminLTE Skins. Choose a skin from the css/skins-->
</head>

<div class="card">
  <div class="card-header text-center">
    <a class="h6"><b>New User</b></a>
  </div>
  <div class="card-body">
    <div class="card card-primary">
      <!-- /.card-header -->
      <!-- form start -->
      <form [formGroup]="form">
        <div class="card-body">
          <div class="form-group" data-select2-id="29">
            <label>Role Title</label>
            <select
              id="role"
              class="form-control select2 select2-hidden-accessible"
              style="width: 100%"
              data-select2-id="1"
              tabindex="-1"
              aria-hidden="true"
              name="role"
            >
              <option selected="selected" data-select2-id="3" disabled>
                Select Role Title
              </option>
              <option *ngFor="let role of allRoles" [ngValue]="role">
                {{ role.roleTitle }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="firstName">First Name</label>
            <input
              [class.is-invalid]="
                form.get('firstName').invalid && form.get('firstName').touched
              "
              id="firstName"
              class="form-control"
              type="text"
              placeholder="First Name"
              name="firstName"
              formControlName="firstName"
            />
          </div>

          <div class="form-group">
            <label for="firstName">Last Name</label>
            <input
              [class.is-invalid]="
                form.get('lastName').invalid && form.get('lastName').touched
              "
              id="lastName"
              class="form-control"
              type="text"
              placeholder="Last Name"
              name="lastName"
              formControlName="lastName"
            />
          </div>

          <div class="form-group">
            <label>Date of Birth</label>
            <div class="input-group date" id="dob" data-target-input="nearest">
              <input
                type="date"
                ng-readonly="true"
                [disabled]
                class="form-control datetimepicker-input"
                data-target="#dob"
                name="dob"
                formControlName="dob"
                min="1900-01-01"
                max="{{ minorCutOff | date: 'yyyy-MM-dd' }}"
              />
              <small *ngIf="" class="text-danger">
                User must be over 18, and alive</small
              >
            </div>
          </div>

          <!--             <div class="form-group">
                <label for="confirmPassword">Re-type Password</label>
                <div class="input-group mb-3">
                    <input id="confirmPassword" class="form-control" type="{{show ? 'text' : 'password'}}"
                        placeholder="Re-type Password" name="confirmPassword" formControlName="confirmPassword" pattern = {{password.value}} />

                    <div class="input-group-append">
                        <div class="input-group-text">
                            <i (click) = "togglePass()" class="{{show ? 'fa fa-eye' : 'fa fa-eye-slash'}}" id="togglePassword"></i>
                        </div>
                    </div>
                </div>
                <div *ngIf="">
                    <small *ngIf="(confirmPassword.errors?.pattern)" class="text-danger">Passwords must match</small>
                </div>
            </div> -->

          <div class="form-group">
            <label for="email">* Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              placeholder="Email"
              name="email"
              formControlName="email"
              [class.is-invalid]="
                form.get('email').invalid && form.get('email').touched
              "
            />

            <div *ngIf="(email.invalid && email.touched) || email.dirty">
              <small *ngIf="email.errors?.required" class="text-danger"
                >Email is required</small
              >
              <!--question mark(?) is a safe navigation operator-->
              <small *ngIf="email.errors?.email" class="text-danger"
                >Invalid email address</small
              >
              <small *ngIf="email.errors?.pattern" class="text-danger"
                >Invalid email address</small
              >
            </div>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input
              type="text"
              class="form-control"
              id="phone"
              phoneMask
              [preValue]="form.value.phone"
              [phoneControl]="form.controls['phone']"
              formControlName="phone"
              formControlName="phone"
              maxlength="14"
              placeholder="(000) 000-0000"
              name="phone"
            />
          </div>
          <div>
            <small *ngIf="phone.errors?.pattern" class="text-danger"
              >Please enter a valid phone number</small
            >
          </div>

          <div class="form-group">
            <label for="username">* Username</label>
            <input
              [class.is-invalid]="
                form.get('username').invalid && form.get('username').touched
              "
              id="username"
              class="form-control"
              type="text"
              placeholder="Username"
              name="username"
              formControlName="username"
            />
          </div>

          <div *ngIf="(username.invalid && username.touched) || username.dirty">
            <!--small *ngIf="form.controls['username'].errors?.usernameExists" class="text-danger">Username is taken</small-->
            <small *ngIf="username.errors?.required" class="text-danger"
              >Username is required</small
            >
            <!--question mark(?) is a safe navigation operator-->
            <small *ngIf="username.errors?.pattern" class="text-danger"
              >Username can have only alphanumeric characters</small
            >
            <small
              *ngIf="username.errors?.minlength || username.errors?.maxlength"
              class="text-danger"
            >
              Username must be more that 4 characters, and contain no more than
              20 characters</small
            >
          </div>

          <div class="form-group">
            <label for="password">* Password</label>
            <div class="input-group">
              <input
                id="password"
                class="form-control"
                type="{{ show ? 'text' : 'password' }}"
                placeholder="Password"
                name="password"
                formControlName="password"
              />

              <div class="input-group-append">
                <div class="input-group-text">
                  <i
                    (click)="togglePass()"
                    class="{{ show ? 'fa fa-eye' : 'fa fa-eye-slash' }}"
                    id="togglePassword"
                  ></i>
                </div>
              </div>
            </div>
            <div
              *ngIf="(password.invalid && password.touched) || password.dirty"
            >
              <small *ngIf="password.errors?.required" class="text-danger"
                >Password is required</small
              >
              <!--question mark(?) is a safe navigation operator-->
              <small
                *ngIf="
                  password.errors?.minlength ||
                  password.errors?.maxlength ||
                  password.errors?.pattern
                "
                class="text-danger"
              >
                Password must contain a number, uppercase and be 7-20 characters
                long</small
              >
            </div>
          </div>

          <div class="form-group">
            <label for="exampleInputFile">File input</label>
            <div class="input-group">
              <div class="custom-file">
                <input
                  type="file"
                  class="custom-file-input"
                  id="exampleInputFile"
                />
                <label class="custom-file-label" for="exampleInputFile"
                  >Choose file</label
                >
              </div>
              <div class="input-group-append">
                <span class="input-group-text">Upload</span>
              </div>
            </div>
          </div>

          <!-- /.card-body -->
        </div>

        <div class="card-footer">
          <button
            class="btn btn-primary"
            [disabled]="!form.valid"
            [type]="'data-toggle'"
            data-toggle="modal"
            data-target="#confirmModal"
            (click)="userService.clear()"
          >
            <span class="ml-1">Make New User</span>
          </button>
        </div>

        <!-- Modal -->
        <div
          class="modal fade"
          id="confirmModal"
          tabindex="-1"
          aria-labelledby="confirmModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h3 class="modal-title" id="exampleModalLabel">
                  Confirmation:
                </h3>
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" *ngIf="!userService.userCreated">
                Are you sure you want to make a new user?
                <div class="text-danger" *ngIf="userService.serverError">
                  Errors in new user: {{ userService.serverErrorMessage }}
                </div>
              </div>
              <div class="modal-body" *ngIf="userService.userCreated">
                User Successfully Created
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-dismiss="modal"
                  *ngIf="!userService.userCreated"
                >
                  Return
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  (click)="createUser()"
                  [type]="'submit'"
                  *ngIf="!userService.userCreated"
                >
                  Confirm
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  data-dismiss="modal"
                  *ngIf="userService.userCreated"
                  (click)="redirect()"
                >
                  View Users
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
